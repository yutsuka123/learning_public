# IoT コマンド仕様書

[重要] 本書は開発・試験で使用するコマンドを定義する。  
理由: 手順の揺れによる再現不可を防ぐため。

## 1. Local MQTT（mosquitto）
- ブローカ起動:
  - `mosquitto -c mosquitto.conf -v`
- Subscribe確認:
  - `mosquitto_sub -h localhost -p 8883 --cafile ca.crt -u "${MQTT_USERNAME}" -P "${MQTT_PASSWORD}" -t "iot/+/status/#" -v`
- Publish確認:
  - `mosquitto_pub -h localhost -p 8883 --cafile ca.crt -u "${MQTT_USERNAME}" -P "${MQTT_PASSWORD}" -t "iot/esp32s3-001/cmd/led" -m "{\"requestId\":\"req-001\",\"ledState\":\"on\"}"`

## 2. PlatformIO（ESP32-S3）
- プロジェクト初期化:
  - `pio project init --board esp32-s3-devkitc-1`
- ビルド:
  - `pio run`
- シリアル監視:
  - `pio device monitor`
- 書込み:
  - `pio run -t upload`

## 3. セキュリティ有効化時の注意
- [厳守] eFuse書込み系コマンドは事前レビュー必須。
- [禁止] 秘密鍵パスを履歴に残す実行方法（平文引数）を使用しない。
- [厳守] MQTT検証はTLS接続コマンドで実施し、平文ポート1883を使わない。
- [禁止] `--insecure` 相当の検証スキップを恒久運用しない。

## 4. 変更履歴
- 2026-02-24: 新規作成。基本コマンドを整理。
- 2026-02-24: 第3段階向けにMQTT TLS + ID/パスワード認証コマンドへ更新。
