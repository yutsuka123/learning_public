# IoT 環境仕様書

[重要] 本書は開発・検証環境を固定化し、再現可能な構築を可能にする。  
理由: セキュリティ有効時は環境差異による不具合切り分けが難しいため。

## 1. 対象環境
- Local OS: Windows または macOS
- ESP: ESP32-S3
- MQTTブローカ: mosquitto（Local PC上、TLS + ID/パスワード認証必須）

## 2. 必須ツール
- PlatformIO（ESPビルド）
- Python（PlatformIO依存）
- mosquitto / mosquitto-clients
- .NET SDK（LocalをC#で実装する場合）
- Pythonランタイム（Local/CloudをPythonで実装する場合）

## 3. PlatformIO方針
- [厳守] `platformio.ini` でプラットフォーム、フレームワーク、ライブラリをバージョン固定する。
- [厳守] ボードはESP32-S3系を指定する。
- [推奨] ビルド環境は `env` を分割し、開発・検証で設定を分離する。
- [推奨] ESPのC++コードは `-std=gnu++20` 等でC++20利用を優先する。

## 4. セキュリティ環境要件（第3段階）
- ROM暗号化有効前後で起動確認手順を分離する。
- セキュアブート鍵素材はローカル安全領域に保存し、リポジトリへ保存しない。
- eFuse適用手順は実行前チェックリストを用意する。
- [厳守] mosquittoはTLS有効設定（CA/サーバー証明書）を適用する。
- [厳守] mosquittoはログインID/パスワード認証を有効化する。
- [禁止] 検証回避のためにTLS検証を無効化した設定を常用しない。

## 5. 変更履歴
- 2026-02-24: 新規作成。ESP32-S3 + PlatformIO前提を明文化。
- 2026-02-24: MQTT TLS + ID/パスワード認証を第3段階必須として追記。
- 2026-02-24: 言語方針に合わせて.NET SDK / Pythonランタイム要件とC++20推奨を追記。
