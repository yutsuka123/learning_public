# IoT TODO

[重要] 未完了タスクのみを管理する。  
理由: 現在の実施対象を明確化するため。

## 未完了
- [ ] `鍵管理初期セットアップ_実装たたき台.md` のPhase1～4に担当・期限を割り当てる。
- [ ] Phase1（K_master_user生成/セキュア保存）の最小実装を先行着手する。
- [ ] Phase2（初回ペアリングAPモード）のUI/CLI手順を確定する。
- [ ] 第3段階のeFuse適用チェックリストを作成する。
- [ ] ESP32-S3向け`platformio.ini`の初版を作成し、依存ライブラリをバージョン固定する。
- [ ] ESP側でC++20を有効化するビルド設定（例: `-std=gnu++20`）を確定する。
- [ ] Local GUIの画面仕様（TLS接続状態、認証状態、接続エラー原因）を文書化する。
- [ ] Local実装言語（C# / Python）を確定し、理由を記録する。
- [ ] mosquittoのTLS + ID/パスワード設定手順書を作成する。
- [ ] ESP側MQTT TLS接続失敗時の再試行戦略を仕様化する。
- [ ] 認証ロジック公開範囲と非公開範囲の判定基準を確定する。
- [ ] Cloud第4段階の候補（AWS/Google）比較表を作成する。
- [ ] ESP側でWi-Fi設定更新ステートマシン（未確定保存/接続試行/CONFIRM/ロールバック）を実装する。
- [ ] ESP側でAES-256-GCM復号処理（nonce/tag検証付き）を実装する。
- [ ] サーバ側で `K_device = HMAC-SHA256(K_master_user, base_mac)` 導出処理を実装する。
- [ ] `public_id` 生成処理（base_mac直接公開禁止）をESP/サーバ双方で統一する。
- [ ] MQTTトピックを `device/<public_id>/wifi/update` / `confirm` へ統一する。
- [ ] AP復旧モード（WPA2/固有パスワード/Web UI）を実装する。
- [ ] Wi-Fi誤設定試験（自動ロールバック）を試験仕様書へ追加する。
- [ ] K_master_user保管手順（Git非保存、秘密管理機構利用）を運用文書へ追加する。
- [ ] セットアップexeで `K_master_user` 生成（CSPRNG 256bit）機能を実装する。
- [ ] `K_master_user` をWindows(DPAPI)/macOS(Keychain)へ保存する実装を追加する。
- [ ] 初回ペアリングAPモード（物理操作必須、短時間有効）を実装する。
- [ ] ペアリング手順（base_mac取得 -> K_device導出 -> デバイス保存）を実装する。
- [ ] `K_master_user` の暗号化バックアップ/復元機能を設計・実装する。
- [ ] バックアップ未保持時の再ペアリング手順を取扱説明書へ追記する。
- [ ] サポートパッケージ生成機能（鍵を含めない）を設計する。

## 運用ルール
- [厳守] 完了タスクは `todo_oldYYYYMMDD.md` へ退避し、本書から削除する。

## 変更履歴
- 2026-02-24: 新規作成。第3段階中心のタスクを初期登録。
- 2026-02-24: 第1/2段階非対象化に合わせ、MQTTセキュア化タスクへ差し替え。
- 2026-02-24: 言語方針（ESP C++20推奨、Local C#/Python選定）に関するタスクを追加。
- 2026-02-24: Wi-Fi設定更新設計（AES-GCM、K_master_user導出、public_id、ロールバック/AP復旧）タスクを追加。
- 2026-02-24: 鍵管理/初期セットアップ（K_master_user、ペアリング、バックアップ、サポート方針）タスクを追加。
- 2026-02-24: 鍵管理初期セットアップ実装たたき台の実行タスクを追加。
