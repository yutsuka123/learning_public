# IoT 使用技術仕様書

[重要] 本書は `IoT` プロジェクトの実装言語・主要技術を定義する。  
理由: 実装開始後の言語ブレを防ぎ、設計と実装の整合性を保つため。

## 1. 言語方針
- ESP:
  - [厳守] C/C++ を採用する。
  - [推奨] C++を利用する場合は可能な範囲で C++20 を採用する。
- Local:
  - [厳守] Windows/macOS 両対応とする。
  - [厳守] C# または Python を採用する。
  - [将来対応] 第3段階着手時に C# / Python の最終選定を行う。
- Cloud:
  - [将来対応] Python 等を候補とし、要件確定時に選定する。

## 2. 技術スタック（現時点）
- ESP:
  - PlatformIO
  - ESP-IDF
  - MQTT（TLS + ID/パスワード認証）
  - Wi-Fi設定暗号化（AES-256-GCM）
- Local:
  - mosquitto（ローカルブローカ）
  - GUI基盤（C#系またはPython系、未確定）
  - 暗号化payload生成（AES-GCM, HMAC-SHA256）
- Cloud:
  - 未確定（Python系を第一候補）
  - K_master_user保護、K_device導出、MQTT ACL制御

## 3. C++20運用方針（ESP）
- [推奨] `platformio.ini` のビルド設定で C++20 を優先する。
- [禁止] C++20が利用可能な箇所で、互換性理由なく旧標準へ戻す運用。
- [厳守] 依存ライブラリ制約でC++20が利用できない場合は、理由を設計書へ記録する。

## 4. セキュリティ連携要件
- [厳守] 言語選定に関わらず、認証情報はGitへアップロードしない。
- [厳守] 認証ロジック公開時は秘密値を分離する。
- [禁止] サンプルコードへ認証実値を直書きしない。
- [厳守] base_macの直接公開を避け、public_id運用を採用する。
- [厳守] Wi-Fi設定はアプリ層暗号（AES-256-GCM）で送受信する。

## 5. 未確定事項
- Local実装を C# / Python のどちらで統一するか。
- Cloud実装言語および実行基盤（AWS / Google 側の採用サービス）。

## 6. 変更履歴
- 2026-02-24: 新規作成。ESP/Local/Cloudの言語方針を定義。
- 2026-02-24: Wi-Fi設定更新設計に合わせ、AES-GCM/HMAC-SHA256とK_master_user運用を追記。
